<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport"
        content="width=device-width, initial-scale=1,
                 user-scalable=no, minimum-scale=1, maximum-scale=1">
  <title>NITTC_CG2</title>

  <style>
    body {
      margin: 0;
      overflow: hidden;
      font-family: sans-serif;
    }
    #ui {
      position: absolute;
      top: 10px;
      left: 10px;
      z-index: 10;
      background: rgba(255,255,255,0.9);
      padding: 10px;
      border-radius: 8px;
    }
    select {
      font-size: 20px;
      width: 240px;
      height: 40px;
    }
  </style>
</head>

<body>

<!-- ===== UI ===== -->
<div id="nav" style="position:fixed; left:10px; bottom:10px; z-index:9999;
  background:rgba(0,0,0,.65); color:#fff; padding:10px 12px; border-radius:10px; font-size:16px; max-width:90vw;">
  ナビ：目的地を選択してください
</div>

<div id="ui">
  <h2>目的地を入力</h2>
  <select id="destination">
    <option value="">選択</option>
    <option value="0">機械工学科棟1F</option>
    <option value="1">北階段前1F</option>
    <option value="2">第一講義棟1F</option>
    <option value="3">電気電子工学科棟1F</option>
    <option value="4">中央交差点1F</option>
    <option value="5">一般管理棟1F</option>
    <option value="6">建築学科棟1F</option>
    <option value="7">南L字角1F</option>
    <option value="8">機械工学科棟2F</option>
    <option value="9">北階段前2F</option>
    <option value="10">第一講義棟2F</option>
    <option value="11">電気電子工学科棟2F</option>
    <option value="12">中央交差点2F</option>
    <option value="13">一般管理棟2F</option>
    <option value="14">建築学科棟2F</option>
    <option value="15">南L字角2F</option>
    <option value="16">機械工学科棟3F</option>
    <option value="17">北階段前3F</option>
    <option value="18">第一講義棟3F</option>
    <option value="19">電気電子工学科棟3F</option>
    <option value="20">中央交差点3F</option>
    <option value="21">一般管理棟3F</option>
    <option value="22">建築学科棟3F</option>
    <option value="23">南L字角3F</option>
  </select>
</div>

<!-- ===== Libraries（ローカルで固定：404回避） ===== -->
<script src="js/three.min.js"></script>
<script src="js/ar-threex.min.js"></script>
<script src="js/route.js"></script>
<script src="js/ARprocess_refactored_full.js"></script>

<!-- ===== UI / Control ===== -->
<script>
  function hideUI() {
    document.getElementById("ui").style.display = "none";
  }

  function setNavText(txt){
    const el = document.getElementById("nav");
    if (el) el.textContent = txt;
  }

  document.getElementById("destination").addEventListener("change", function (e) {
    if (e.target.value === "") return;

    const goalId = Number(e.target.value);

    // ★ AR側の goalNodeId を確実にセット（改善1）
    if (typeof window.setGoalNode === "function") {
      window.setGoalNode(goalId);
    } else {
      console.warn("setGoalNode is not available yet.");
      setNavText("ナビ：目的地を設定できません（setGoalNode未定義）");
      return;
    }

    hideUI();
  });

  // 最初の表示
  setNavText("ナビ：目的地を選択してください");
</script>

</body>
</html>
